<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小狗创作中</title>
    <style>
        @font-face {
            font-family: '京华老宋体';
            src: url('https://your-font-url/jinghualaosongti.woff2') format('woff2');
        }
        body {
            font-family: '京华老宋体', Arial, sans-serif;
            background: #fff;
            text-align: center;
            margin: 0;
            padding: 20px;
            position: relative;
        }
        h1 { font-size: 24px; }
        .clock { position: absolute; top: 10px; left: 10px; font-size: 16px; }
        .counter { position: absolute; top: 10px; right: 10px; font-size: 16px; }

        /* 右上角 Pages 菜单 */
        .menu {
            position: absolute;
            top: 40px;
            right: 10px;
        }
        .menu button {
            background: #333;
            color: #fff;
            border: none;
            padding: 8px 12px;
            cursor: pointer;
        }
        .dropdown {
            display: none;
            position: absolute;
            right: 0;
            background: #fff;
            border: 1px solid #ccc;
            padding: 10px;
            text-align: left;
        }
        .menu:hover .dropdown { display: block; }

        /* 分类导航 */
        .nav {
            margin-top: 50px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .nav button {
            margin: 5px;
            padding: 8px 12px;
            background: #555;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        .nav button:hover { background: #777; }

        .content { display: none; white-space: pre-line; margin-top: 10px; }
        .footer { margin-top: 20px; font-size: 14px; color: gray; }

        /* 作品样式 */
        .work {
            border-bottom: 1px solid #ddd;
            padding: 10px;
            margin: 10px auto;
            width: 90%;
            max-width: 600px;
            text-align: left;
        }
        img { max-width: 100%; height: auto; display: block; margin: 10px auto; }
    </style>
</head>
<body oncontextmenu="return false;">
    <div class="clock" id="clock">时间加载中...</div>
    <div class="counter">访问量：<span id="viewCount">加载中...</span></div>

    <!-- 右上角 Pages -->
    <div class="menu">
        <button>Pages</button>
        <div class="dropdown">
            <div class="nav" id="categoryNav"></div>
        </div>
    </div>

    <h1>小狗创作中</h1>
    <h2>最新作品</h2>
    <div id="content">加载中...</div>

    <div class="footer">联系方式：oloiyy@163.com</div>

    <script>
        function updateClock() {
            document.getElementById('clock').textContent = new Date().toLocaleTimeString();
        }
        setInterval(updateClock, 1000);
        updateClock();

        if (!localStorage.viewCount) localStorage.viewCount = 0;
        localStorage.viewCount = parseInt(localStorage.viewCount) + 1;
        document.getElementById("viewCount").textContent = localStorage.viewCount;

        async function fetchIssues() {
            const username = "joinliving";
            const repo = "puppy";
            const url = `https://api.github.com/repos/${username}/${repo}/issues?state=open`;

            try {
                const response = await fetch(url);
                const issues = await response.json();
                const contentDiv = document.getElementById("content");
                const categoryNav = document.getElementById("categoryNav");

                contentDiv.innerHTML = "";
                categoryNav.innerHTML = '<button onclick="filterCategory(\'全部\')">全部</button>';

                let categories = {};

                issues.forEach(issue => {
                    const category = issue.labels.length > 0 ? issue.labels[0].name : "未分类";
                    if (!categories[category]) categories[category] = [];
                    categories[category].push(issue);
                });

                Object.keys(categories).forEach(category => {
                    const categoryButton = document.createElement("button");
                    categoryButton.textContent = category;
                    categoryButton.onclick = () => filterCategory(category);
                    categoryNav.appendChild(categoryButton);
                });

                issues.forEach(issue => {
                    const category = issue.labels.length > 0 ? issue.labels[0].name : "未分类";

                    const workDiv = document.createElement("div");
                    workDiv.classList.add("work");
                    workDiv.dataset.category = category;

                    const title = document.createElement("h2");
                    title.textContent = issue.title;

                    const content = document.createElement("div");
                    content.classList.add("content");
                    content.style.display = "none";
                    content.innerHTML = issue.body.replace(/\n/g, "<br>").replace(/!\[.*?\]\((.*?)\)/g, '<img src="$1">');

                    const toggleButton = document.createElement("button");
                    toggleButton.textContent = "展开正文";
                    toggleButton.onclick = function () {
                        if (content.style.display === "none") {
                            content.style.display = "block";
                            toggleButton.textContent = "收起正文";
                        } else {
                            content.style.display = "none";
                            toggleButton.textContent = "展开正文";
                        }
                    };

                    workDiv.appendChild(title);
                    workDiv.appendChild(toggleButton);
                    workDiv.appendChild(content);
                    contentDiv.appendChild(workDiv);
                });

            } catch (error) {
                document.getElementById("content").textContent = "加载失败，请检查 GitHub 配置";
            }
        }

        function filterCategory(category) {
            document.querySelectorAll(".work").forEach(work => {
                if (category === "全部" || work.dataset.category === category) {
                    work.style.display = "block";
                } else {
                    work.style.display = "none";
                }
            });
        }

        fetchIssues();
    </script>
</body>
</html>